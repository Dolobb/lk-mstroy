Проект: Инструментарий аналитики выработки самосвалов
Часть 1: Цель и ключевые показатели
Цель — создать инструмент для глубокой аналитики работы самосвалов, объединяющий данные о назначенных заявках, телеметрии и технических характеристиках парка (грузоподъемности).
Ключевые расчетные метрики (KPI):
КИП (%): Отношение фактического времени работы ДВС к эталонным 10 часам (600 мин).
Формула: 
.
В движении (%): Отношение времени перемещения (скорость > 0) к эталонным 10 часам.
Формула: 
.
Факт. объем (т): Суммарный перевезенный объем за смену.
Логика: Кол-во рейсов 
 Грузоподъемность конкретного ТС (подгружается из справочника).
Сменный режим: 1 смена (07:30 – 19:30), 2 смена (19:30 – 07:30).
Часть 2: Архитектура финальной страницы
1 блок (Шапка с фильтрами и KPI) — ~15% высоты:
Фильтры: Период (Неделя, Месяц, произвольный диапазон), СМУ и Регион (выпадающие списки).
Индикаторы:
Динамический счетчик Кол-во ТС (зависит от фильтров).
Сводные карточки по сменам (1 и 2): отображают усредненные проценты КИП и Движения по выбранной выборке машин.
2 блок (Табличная аналитика) — Центр (основной объем данных):
Интерактивная таблица, данные в которой обновляются при применении фильтров (по умолчанию — за вчерашний день).
Структура колонок:
№ п/п, Марка, Гос. №.
План по заявке: № заявки, Заявитель, Объект затрат, Объем (т).
Факт по навигации: Рейсы (кол-во), Объём (Рейсы 
 Грузоподъемность), Остаток (План — Факт).
Временные потери: Простой под погрузкой (мин), Простой под выгрузкой (мин).
3 блок (Интерактивная карта):
Отображает геозоны объектов строительства и маршруты ТС. Позволяет визуально контролировать скопление машин в зонах погрузки/выгрузки.
Часть 3: Логика сбора и обработки данных
1. Алгоритм рейсов и объемов:
Детекция рейса: Система отслеживает пересечение координат ТС с границами геозоны погрузки. При зафиксированном выходе из зоны засчитывается +1 рейс.
Учет вместимости: В систему загружается справочный список грузоподъемности (сколько тонн может перевезти каждая марка/госномер). При каждом новом рейсе система автоматически суммирует этот показатель в колонку «Объем (факт)».
2. Интеграция и API:
API Навигации: Сбор данных по телеметрии (координаты, скорость, статус ДВС).
API Заявок: Получение данных о плановых заданиях из путевых листов/заявок.
Кэширование: Все расчетные данные за смену (КИП, рейсы, простои) сохраняются в PostgreSQL раз в сутки. Это позволяет мгновенно строить отчеты за прошлые периоды без обращения к внешним API.
3. Технологический стек:
Frontend: React + TypeScript + Material-UI (DataGrid) + Leaflet + D3.js.
Backend: Node.js (Express) + PostgreSQL (PostGIS для анализа геозон).
DevOps: Docker + Kubernetes.



### пример запроса на мониторинг (часть)
{
    "moUid": "А983ЕР172",
    "orgName": "ТФ \"Мостоотряд-36\" филиал АО \"Мостострой-11\"",
    "nameMO": "Фургон Ford Transit",
    "invNumber": null,
    "distance": 3316.64,
    "movingTime": 128893,
    "engineTime": 166830,
    "lastActivityTime": "26.01.2026 23:57",
    "engineIdlingTime": 37937,
    "ignitionWork": true,
    "equipmentTime": null,
    "movingRate": 0.0,
    "track": [
        {
            "lon": 58.149603,
            "lat": 56.763792,
            "direction": 14,
            "time": "24.01.2026 00:01:02",
            "speed": 0
        },
        {
            "lon": 58.149518,
            "lat": 56.763745,
            "direction": 348,
            "time": "24.01.2026 00:03:21",
            "speed": 2
        },
        {
            "lon": 58.149165,
            "lat": 56.763775,
            "direction": 246,
            "time": "24.01.2026 00:03:37",
            "speed": 7
        },
        {
            "lon": 58.148993,
            "lat": 56.763578,
            "direction": 181,
            "time": "24.01.2026 00:03:52",
            "speed": 8
        },
        {
            "lon": 58.148897,
            "lat": 56.763063,
            "direction": 213,
            "time": "24.01.2026 00:04:13",
            "speed": 12
        },
        {
            "lon": 58.14847,
            "lat": 56.762982,
            "direction": 273,
            "time": "24.01.2026 00:04:19",
            "speed": 20
        },
        {
            "lon": 58.146377,
            "lat": 56.76317,
            "direction": 280,
            "time": "24.01.2026 00:04:32",
            "speed": 49
        },
        {
            "lon": 58.143907,
            "lat": 56.763485,
            "direction": 286,
            "time": "24.01.2026 00:04:44",
            "speed": 51
        },
        {
            "lon": 58.14191,
            "lat": 56.76391,
            "direction": 294,
            "time": "24.01.2026 00:04:52",
            "speed": 58
        },
        {
            "lon": 58.14117,
            "lat": 56.764105,
            "direction": 296,
            "time": "24.01.2026 00:04:56",
            "speed": 61
        },
        {
            "lon": 58.139685,
            "lat": 56.76455,
            "direction": 301,
            "time": "24.01.2026 00:05:01",
            "speed": 62
        },
        {
            "lon": 58.138712,
            "lat": 56.764887,
            "direction": 302,
            "time": "24.01.2026 00:05:05",
            "speed": 64
        },
        {
            "lon": 58.130488,
            "lat": 56.767903,
            "direction": 303,
            "time": "24.01.2026 00:05:37",
            "speed": 67
        },
        {
            "lon": 58.127343,
            "lat": 56.769015,
            "direction": 299,
            "time": "24.01.2026 00:05:50",
            "speed": 69
        },
        {
            "lon": 58.124503,
            "lat": 56.769817,
            "direction": 294,
            "time": "24.01.2026 00:05:59",
            "speed": 69
        },
        {
            "lon": 58.12391,
            "lat": 56.769967,
            "direction": 293,
            "time": "24.01.2026 00:06:03",
            "speed": 69
        },
        {
            "lon": 58.120978,
            "lat": 56.770575,
            "direction": 288,
            "time": "24.01.2026 00:06:11",
            "speed": 69
        },
### пример геозон
 {
  "type" : "FeatureCollection",
  "generator" : "fleetradar-monitoring",
  "features" : [ {
    "type" : "Feature",
    "properties" : {
      "zoneName" : "СМУ г. Тюмень, Ремонт моста через протоку оз. Алебашево",
      "uid" : "MOST1718594200730",
      "zoneGroup" : "",
      "controlType" : 1,
      "region" : "",
      "town" : "",
      "road" : "",
      "priority" : 0
    },
    "geometry" : {
      "type" : "Polygon",
      "coordinates" : [[[65.570478,57.177986],[65.570757,57.1788],[65.572516,57.17916],[65.574211,57.179021],[65.574919,57.177707],[65.573847,57.175614],[65.573203,57.173463],[65.56919,57.173859],[65.570478,57.177986]]]
    }
  }, {
    "type" : "Feature",
    "properties" : {
      "zoneName" : "СМУ г. Тюмень, Пермякова-Федюнинского",
      "uid" : "TEST1501566785954",
      "zoneGroup" : "Объекты",
      "controlType" : 1,
      "region" : "Тюменская область",
      "town" : "Тюмень",
      "road" : "",
      "priority" : 0
    },
    "geometry" : {
      "type" : "Polygon",
      "coordinates" : [[[65.54949,57.108368],[65.54949,57.108974],[65.54979,57.109394],[65.550606,57.109604],[65.55185,57.10956],[65.55322,57.109257],[65.55455,57.108765],[65.55687,57.107975],[65.55936,57.10704],[65.56082,57.106575],[65.56254,57.106506],[65.56378,57.106297],[65.56451,57.10578],[65.56494,57.105316],[65.56601,57.104942],[65.57091,57.10315],[65.57155,57.10259],[65.57163,57.10203],[65.57142,57.101612],[65.57091,57.101402],[65.56975,57.101448],[65.568756,57.101635],[65.564255,57.103405],[65.563225,57.103218],[65.56236,57.103104],[65.56159,57.10308],[65.56056,57.103172],[65.5597,57.103428],[65.55901,57.103733],[65.558586,57.104103],[65.55811,57.1045],[65.55747,57.104897],[65.55657,57.105362],[65.55571,57.105644],[65.55451,57.106064],[65.553955,57.106388],[65.55331,57.106644],[65.55228,57.106995],[65.55129,57.107414],[65.55018,57.10788],[65.54949,57.108368]]]
    }