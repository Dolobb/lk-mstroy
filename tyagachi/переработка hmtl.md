# ТЕХНИЧЕСКОЕ ЗАДАНИЕ  

## Рефакторинг страницы аналитики заявки  
(без добавления новых данных и сущностей)

---

## 0. Контекст задачи

Имеется существующая HTML-страница аналитики заявок, в которой:
- данные корректны,
- иерархия данных логична,
- но визуальная структура построена как глубокая вертикальная вложенность («матрёшка»),
- страница плохо использует горизонтальное пространство,
- аналитика одной заявки требует постоянного скролла и потери контекста.

Задача:  
**НЕ создавать новую систему**, а **переразложить существующие блоки страницы**, чтобы интерфейс соответствовал реальным сценариям аналитика.

---

## 1. Жёсткие ограничения (обязательные)

Запрещено:
- менять структуру и логику данных или переделывать иерархию

Разрешено:
- менять layout (grid / flex);
- перемещать существующие DOM-блоки;
- менять порядок и вложенность отображения;
- менять поведение раскрытия / сворачивания;
- делать sticky / фиксированные зоны.

---

## 2. Исходные сущности (использовать ТОЛЬКО их)

В HTML уже присутствуют следующие логические блоки, они **остаются неизменными по смыслу**:

- Заявка
- Путевой лист (ПЛ)
- Машина
- Вкладка / блок «План» заявки (несколько контейнеров)
- Фактические данные мониторинга
- Данные по сменам
- Карта маршрута
- Параметры заявки (маршрут, груз, расстояние и т.д.)

❗ Все данные берутся строго из существующих HTML-узлов.

---

## 3. Пользовательские сценарии (ключевые)

### 3.1 Быстрый скрининг заявки (~50%)

Поведение:
- пользователь быстро просматривает заявку;
- оценивает корректность и наличие аномалий;
- НЕ углубляется в путевые листы;
- при отсутствии проблем отправляет заявку в архив.

Требование:
- контекст заявки и ключевые данные должны быть видны без глубокого скролла.

---

### 3.2 Глубокий разбор заявки (~50%)

Поведение:
- пользователь долго анализирует одну заявку;
- активно сравнивает план vs факт;
- использует карту и числа параллельно;
- чаще работает с одной выбранной машиной;
- реже — с несколькими машинами в рамках заявки.

Требование:
- все основные инструменты анализа должны быть доступны одновременно на экране.

---

## 4. Новая базовая структура страницы

Страница должна быть переразложена в **3 вертикальные колонки**, занимающие всю ширину экрана.
| Левая колонка | Центральная колонка | Правая колонка |
Вертикальная вложенная структура вида  
`Заявка → ПЛ → Машина → Факт → ...`  
в виде одной колонки — **запрещена**.
---

## 5. Левая колонка — План и контекст заявки

### Назначение
Постоянная точка отсчёта анализа.

### Содержимое (использовать существующие блоки):
- все контейнеры, относящиеся к вкладке **«План»** заявки;
- параметры заявки (маршрут, груз, расстояние и т.д.);
- расчётные показатели и объект затрат (если уже присутствуют).

❗ Никакие новые поля не добавлять.

### Поведение:
- фиксированная ширина;
- независимый вертикальный скролл;
- допускается сворачивание отдельных контейнеров плана;
- структура плана всегда доступна визуально.

---

## 6. Центральная колонка — Карта заявки

### Назначение
Основной визуальный и аналитический инструмент.

### Содержимое:
- существующий HTML-блок карты;
- существующие элементы управления картой;
- отображение маршрутов машин в рамках заявки.

### Поведение:
- карта занимает максимальную доступную высоту;
- не должна теряться при скролле страницы;
- при выборе машины (если это уже реализовано) визуально отражает фокус.

❗ Запрещено добавлять новые элементы управления картой.

---

## 7. Правая колонка — Факт и мониторинг

### Назначение
Детальная аналитика фактического выполнения.

### Содержимое:
- все существующие блоки факта мониторинга по машине;
- данные по сменам;
- числовые показатели, которые сейчас находятся внутри вложенных уровней ПЛ / машины.

### Поведение:
- контекстная логика:
  - при выборе машины — показываются её данные;
  - при отсутствии выбора — текущая логика отображения данных по заявке;
- независимый скролл;
- минимальная вложенность.

---

## 8. Путевые листы (ПЛ)

### Роль
ПЛ остаются существующим объектом данных, но **перестают быть основным уровнем навигации**.

### Требования:
- ПЛ отображаются **свернутыми по умолчанию**;
- в свернутом виде показывают:
  - номер ПЛ;
  - номер машины;
  - период (если есть в текущих данных);
- раскрываются только при явном действии пользователя.

❗ Никакие данные ПЛ не удаляются и не модифицируются.

---

## 9. Работа с машинами

- В рамках заявки пользователь чаще работает с **одной выбранной машиной**.
- Реже — с несколькими машинами одной заявки.

Требования:
- выбор машины влияет на:
  - содержимое правой колонки;
  - визуальный фокус на карте (если уже реализовано).

---

## 10. Критерии корректной реализации

Результат считается корректным, если:

1. Используются только существующие данные и HTML-блоки  
2. Нет новых сущностей, кнопок и логики  
3. Убрана глубокая вертикальная «матрёшка»  
4. Вся ширина экрана используется для аналитики  
5. Поддерживаются оба сценария работы  
6. Одна заявка визуально ощущается как отдельное аналитическое пространство  

---

## 11. Ожидаемый итог

Переразложенная страница аналитики заявки, которая:
- сохраняет текущие данные и логику;
- значительно улучшает навигацию и ориентацию;
- позволяет одновременно работать с планом, картой и фактом;
- не требует изменений backend-части.

# РЕЗУЛЬТАТЫ ИНТЕРВЬЮ ДЛЯ БОЛЬШЕГО КОНТЕКСТА
Ладно, поехали глубже. Ты сейчас описал не «хочу красиво», а **очень конкретный аналитический сценарий**, и это редкость. Обычно люди мямлят «неудобно». Тут можно реально вытащить нормальную архитектуру, а не косметику.

Я сначала **зафиксирую, что мы уже точно знаем о пользователе (о тебе)**, потом предложу **целостную модель интерфейса**, потом разложу **по экранам / состояниям**, и в конце дам **скелет ТЗ**, который можно отдавать дизайнеру или фронту без испанского стыда.

---

## 1. Кто пользователь и как он реально работает (без романтики)

Ты не «смотришь отчёт».
Ты **принимаешь решение: копать или выкинуть**.

У тебя есть два режима, и это ключ:

### Режим А. Скрининг (50%)

* быстро
* поверхностно
* цель: **отбросить нормальные заявки**
* основной инструмент: агрегаты + маркеры аномалий
* действие: «в архив»

### Режим Б. Разбор (50%)

* медленно
* глубоко
* цель: **понять, где именно косяк и кто виноват**
* основной инструмент: карта + факты + план
* действие: выводы, фиксация

❗️Самая большая ошибка текущего интерфейса
Он **не разделяет эти режимы**. Он одинаково неудобен и для быстрого, и для глубокого.

---

## 2. Главный UX-переворот, который надо принять

### Перестаем думать, что страница = иерархия данных

### Начинаем думать, что страница = рабочее пространство

Ты уже это интуитивно сказал фразой «видеть всё сразу и переключать внимание».

Это не матрёшка.
Это **аналитический стол**.

---

## 3. Базовая структура новой страницы заявки

Я опишу не «как выглядит», а **как этим пользуются глазами**.

### Глобально: 3 вертикальных блока. Всегда.

```
| План / Контекст | Карта | Факт / Мониторинг |
```

Не вкладки, не раскрывашки.
**Три постоянно присутствующих смысловых зоны.**

---

## 4. Левая колонка. План + контекст заявки

Это не «инфо о заявке».
Это **точка отсчёта**, от которой ты всё сравниваешь.

### Содержимое:

* Все 9 контейнеров вкладки «План»
* Объект затрат
* Расчётные показатели
* Ограничения и ожидания

### UX-принципы:

* колонка **фиксированная по ширине**
* скроллится независимо
* всегда видна целиком как структура, даже если часть свернута

### Почему это важно

Ты сам сказал:

> «при просмотре одной заявки — всё, что относится к плану, должно быть перед глазами»

И ты прав. Это не «параметры перед глазами», это **рамка анализа**.
Без неё все факты и карта — просто шум.

---

## 5. Центральная колонка. Карта как главный аналитический инструмент

Тут очень важно:
**карта — это не визуализация, это контроллер внимания.**

### Что должна уметь карта в твоём сценарии:

* несколько машин в рамках заявки
* переключение фокуса на одну машину
* временной контекст (таймлайн или ползунок)
* включение / выключение слоёв (стоянки, заправки, отклонения)

### Ключевой UX-момент

Карта **не должна скроллиться вместе со страницей**.
Она либо:

* фиксирована по высоте
* либо занимает максимум доступного пространства

Иначе ты всё время «теряешь сцену».

---

## 6. Правая колонка. Факт и мониторинг

Это самая нагруженная зона, и именно её сейчас ты хоронишь в глубине матрёшки.

### Содержимое:

* 6 контейнеров факта мониторинга
* данные по сменам
* всё, что относится к конкретной машине / событию

### Поведение:

* контекстная
* реагирует на:

  * выбор машины
  * выбор точки на карте
  * выбор временного отрезка

❗️Важно
Правая колонка **не показывает всё сразу**.
Она показывает **то, что сейчас в фокусе внимания**.

---

## 7. Что делать с путевыми листами (окончательно)

ПЛ — это **техническая проекция**, а не уровень навигации.

### Новая роль ПЛ:

* мета-объект
* фильтр
* контейнер данных

### Где они живут:

* внутри левой колонки как список под заявкой
* или внутри карточки машины
* или как фильтр над картой

### Как выглядят:

* свернуты по умолчанию
* показывают:

  * номер ПЛ
  * номер машины
  * период
  * краткие индикаторы

Открываются **только когда ты уже в разборе**, а не на входе.

---

## 8. Новый сценарий: мониторинг по машине (очень важный)

Ты описал боль, и это прям отдельный экран.

### Сейчас:

* поиск машины
* получаешь свалку заявок
* контекст потерян

### Должно быть:

**Экран машины как отдельный аналитический объект**

Структура та же:

```
| Машина (контекст) | Карта | Хронология / Факты |
```

Где:

* слева: машина + агрегаты + фильтры
* по центру: карта за период
* справа: список заявок / смен / событий по времени

Заявка здесь — **эпизод**, а не корень.

---

## 9. Как пользователь реально работает в новом интерфейсе

### Сценарий 1. Быстрый скрининг

* открываешь заявку
* видишь план + агрегаты
* смотришь карту 5–10 секунд
* если всё ок → «в архив»
* если нет → углубляешься

Без раскрытия ПЛ. Без скролла в ад.

---

### Сценарий 2. Глубокий разбор

* фиксируешь план слева
* работаешь картой
* кликаешь на машину
* смотришь факты справа
* сравниваешь ожидание vs реальность

Ты **переключаешь внимание**, а не интерфейс.

---

## 10. Почему это реально можно реализовать без переписывания всего

Это важно, чтобы не было ощущения «давай всё с нуля».

* данные уже есть
* иерархия уже есть
* проблема только в:

  * приоритизации
  * расположении
  * поведении блоков

Фронту это:

* flex/grid
* sticky
* контекстные состояния

А не «переписать бэк».

---

## 11. Черновой скелет ТЗ (очень коротко)

Если сжать до сути:

1. Страница заявки — 3-колоночная, без вложенной вертикальной матрёшки
2. Левая колонка — план + контекст, фиксированная
3. Центр — карта как основной инструмент
4. Правая колонка — факт и мониторинг, контекстная
5. ПЛ — свернуты, не являются точкой входа
6. Отдельный экран анализа по машине
7. Поддержка двух режимов: скрининг / разбор

---

Если хочешь дальше идти максимально прагматично, следующий шаг я бы делал такой:

* либо рисуем **логическую схему состояний** (не дизайн)
* либо превращаем это в **структурированное ТЗ по блокам и состояниям**
* либо разбираем твой HTML и прямо говорим: «вот это переезжает сюда, это сюда, это умирает»

Интерфейс у тебя сейчас честный, но наивный.
Новый должен быть **наглым и удобным**, потому что аналитик не обязан страдать ради истины.
